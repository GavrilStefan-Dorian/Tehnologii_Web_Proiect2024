<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Boo - Book Reviewer</title>
    <link rel="stylesheet" href="../Styling/book.css">
    <link rel="stylesheet" href="../Styling/sidebar.css">
    <script src="../JavaScript/components.js"></script>
    <script src="../JavaScript/book.js"></script>
    <script src="../JavaScript/req_wrapper_jwt.js"></script> 
    
</head>
<body>
    <div class="sidebar-padded">
        <div class="book">
            <img id="cover" class="book__image" src="../Resources/Images/BookFull.png" alt>
            <div class="book__info">
                <div class="book__info__header">
                    <div class="book__info__header__info">
                        <p id="title" class="book__info__header__info__title">Atomic Habits</p>
                        <p id="author" class="book__info__header__info__author">by James Clear</p>
                        <div class="book__info__header__info__rating">
                            <img class="book__info__header__info__rating__star" src="../Resources/Svg/star.svg" alt>
                            <img class="book__info__header__info__rating__star" src="../Resources/Svg/star.svg" alt>
                            <img class="book__info__header__info__rating__star" src="../Resources/Svg/star.svg" alt>
                            <img class="book__info__header__info__rating__star" src="../Resources/Svg/star.svg" alt>
                            <img class="book__info__header__info__rating__star" src="../Resources/Svg/star.svg" alt>
                            <p id="rating" class="book__info__header__info__rating_text">4.08</p>
                    </div>
                    <p id="numRatings" class="book__info__header__info__ratings">123,493 ratings</p>
                </div>
                <div class="book__info__header__buttons">
                    <img class="book__info__header__buttons__button" src="../Resources/Svg/bookmark.svg" alt>
                    <img class="book__info__header__buttons__button" src="../Resources/Svg/heart.svg" alt>
                    <img class="book__info__header__buttons__button" src="../Resources/Svg/options.svg" alt>
                </div>
            </div>
            <p id="description" class="book__info__summary">This breakthrough book from James Clear is the most comprehensive guide on how to change your habits and get 1% better every day.</p>

            <div class="book__info__download">
                <p class="book__info__download__text">Download</p>
            </div>
        </div>
    </div>
    <div class="details">
        <!--<p class="details__about">About this book</p>
        <p id="description" class="details__description">No matter your goals, Atomic Habits offers a proven framework for improving--every day. James Clear, one of the world's leading experts on habit formation, reveals practical strategies that will teach you exactly how to form good habits, break bad ones, and master the tiny behaviors that lead to remarkable results.<br><br>If you're having trouble changing your habits, the problem isn't you. The problem is your system. Bad habits repeat themselves again and again not because you don't want to change, but because you have the wrong system for change. You do not rise to the level of your goals. You fall to the level of your systems. Here, you'll get a proven system that can take you to new heights.</p>
        !-->
        <p class="details__review">Reviews</p>
        <p id="starsText" class="details__review__text">What would you rate this book?</p>
        <div id="stars" class="details__review__stars">
            <img onmouseover="onStarsHovered(1)" onmouseleave="onStarsUnhovered()" onmousedown="onStarsClicked(1)" class="details__review__stars__star" src="../Resources/Svg/star.svg" alt>
            <img onmouseover="onStarsHovered(2)" onmouseleave="onStarsUnhovered()" onmousedown="onStarsClicked(2)" class="details__review__stars__star" src="../Resources/Svg/star.svg" alt>
            <img onmouseover="onStarsHovered(3)" onmouseleave="onStarsUnhovered()" onmousedown="onStarsClicked(3)" class="details__review__stars__star" src="../Resources/Svg/star.svg" alt>
            <img onmouseover="onStarsHovered(4)" onmouseleave="onStarsUnhovered()" onmousedown="onStarsClicked(4)" class="details__review__stars__star" src="../Resources/Svg/star.svg" alt>
            <img onmouseover="onStarsHovered(5)" onmouseleave="onStarsUnhovered()" onmousedown="onStarsClicked(5)" class="details__review__stars__star" src="../Resources/Svg/star.svg" alt>
        </div>
        <div id="details__more" class="details__review__more" style="display: none">
            <p class="details__review__more__text">Tell us about your experience...</p>
            <span id="review__input" class="details__review__more__input" role="textbox" contenteditable placeholder="Tell us about your experience..."></span>
            <button class="details__review__more__button" onclick="onSendReview()">
                <p class="details__review__more__button__text">Send</p>
            </button>
        </div>
        <div class="details__reviews">
        </div>
    </div>
</div>

<script>
    
    createSidebar(1);

    let starList = document.getElementById("stars");

    let clicked = false;
    let userRating = 0;

    function onStarsClicked(stars)
    {
        if(clicked)
            return;

        clicked = true;
        userRating = stars;
        document.getElementById("details__more").style.display = "";
    }

    function onStarsUnhovered()
    {
        if(clicked)
            return;

        for(let i = 0; i < starList.childElementCount; i++)
        {
            starList.children[i].classList.remove("details__review__stars__star");
            starList.children[i].classList.remove("details__review__stars__star--gold");
        }

        for(let i = 0; i < starList.childElementCount; i++)
        {
            starList.children[i].classList.add("details__review__stars__star");
        }
    }
    function onStarsHovered(starCount)
    {
        if(clicked)
            return;

        for(let i = 0; i < starList.childElementCount; i++)
        {
            starList.children[i].classList.remove("details__review__stars__star");
            starList.children[i].classList.remove("details__review__stars__star--gold");
        }

        for(let i = 0; i < starCount; i++)
        {
            starList.children[i].classList.add("details__review__stars__star--gold");
        }

        for(let i = starCount; i < starList.childElementCount; i++)
        {
            starList.children[i].classList.add("details__review__stars__star");
        }
    }

    [|user|]
    [|book|]
    [|reviews|]

    console.log(book);

    if(!user || user.reviewedBook)
    {
        starList.style.display = "none";
        document.getElementById("starsText").style.display = "none";
    }

    document.getElementById("title").innerText = book.title;
    document.getElementById("author").innerText = book.author;
    document.getElementById("rating").innerText = book.rating;
    document.getElementById("numRatings").innerText = book.numratings + " ratings";
    document.getElementById("description").innerText = book.description;
    document.getElementById("cover").src = book.coverimg;

    const htmlReviews = [];
    reviews.forEach(x => htmlReviews.push(createReview(x.username, x.creation_date, x.description, x.rating)));
    const reviewList = document.getElementsByClassName("details__reviews")[0];
    htmlReviews.forEach(x => reviewList.innerHTML += x);

    function onSendReview()
    {
        let input = document.getElementById("review__input");
        let text = input.innerText;

        if(!text)
            return;

        reviewList.innerHTML = createReview(user.username, Date.now(), text, userRating) + reviewList.innerHTML;
        starList.style.display = "none";
        document.getElementById("starsText").style.display = "none";
        document.getElementById("details__more").style.display = "none";
    }
    
    // document.addEventListener('DOMContentLoaded', function() {
    //     handleNavigation(() => {

    //     });
    // });
</script>
</body>
</html>
